<VirtualHost *:80>
        ServerAlias buddycloud.*
        RewriteEngine On
        RewriteCond %{HTTP_HOST} ^buddycloud\.(.*)$
        RewriteRule ^(.*)$ https://http.EXAMPLE.COM/?h=%1
</VirtualHost>

<VirtualHost *:443>
        ServerName  web-hosting.EXAMPLE.COM
        ServerAlias *.EXAMPLE.COM
        SSLEngine On
        SSLCertificateFile      /etc/apache2/certs/dot-local-wildcard.certificate.pem
        SSLCertificateKeyFile   /etc/apache2/certs/dot-local-wildcard.key.pem
        DocumentRoot /usr/share/buddycloud-webclient/
        LogLevel alert
        ErrorLog  /var/log/buddycloud-apache-error.log
        CustomLog /var/log/buddycloud-apache-access.log combined
        RewriteEngine On
        RewriteCond %{REQUEST_URI} !^/js/
        RewriteCond %{REQUEST_URI} !^/img/
        RewriteCond %{REQUEST_URI} !^/css/
        RewriteCond %{REQUEST_URI} !^/timestamp
        RewriteCond %{REQUEST_URI} !^/prototypes/
        RewriteCond %{REQUEST_URI} !^/locales/
        RewriteCond %{REQUEST_URI} !^/config\.js$
        RewriteCond %{REQUEST_URI} !^/manifest\.webapp$
        RewriteCond %{REQUEST_URI} !^/api/
        RewriteCond %{REQUEST_URI} !^/primus/
        RewriteCond %{REQUEST_URI} !^/scripts/primus/
        RewriteCond %{REQUEST_URI} !^/ws-xmpp
        RewriteCond %{REQUEST_URI} !^(.*)\.html$
        RewriteCond %{REQUEST_URI} !^/favicon.ico$
        RewriteRule ^(.*)$ /index.html

        # Set CORS header        
        SetEnvIf Origin "http(s)?://(.+)" AccessControlAllowOrigin=$
0
        Header set Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin

        # Speed up the website
        FileETag                             None
        ExpiresActive On
        ExpiresDefault                       "access plus 1 seconds"
        ExpiresByType text/html              "access plus 1 hours"
        ExpiresByType image/jpeg             "access plus 1 hours"
        ExpiresByType image/png              "access plus 1 hours"
        ExpiresByType text/css               "access plus 1 hours"
        ExpiresByType application/javascript "access plus 1 hours"
        # For Firefox OS Manifest file serving
        AddType application/x-web-app-manifest+json .webapp

        KeepAlive On
        ProxyPass /api/ http://127.0.0.1:9123/
        ProxyPassReverse /api/ http://127.0.0.1:9123/
        
        ProxyPass /primus/1/websocket ws://127.0.0.1:6000/primus/1/websocket
	ProxyPassReverse /primus/1/websocket ws://127.0.0.1:6000/primus/1/websocket

	ProxyPass /ws-xmpp ws://127.0.0.1:5290/
        ProxyPassReverse /ws-xmpp ws://127.0.0.1:5290/

	ProxyPass /primus/ http://127.0.0.1:6000/primus/
	ProxyPassReverse /primus/ http://127.0.0.1:6000/primus/

        ProxyPass /scripts/primus/ http://127.0.0.1:6000/scripts/primus/
        ProxyPassReverse /scripts/primus/ http://127.0.0.1:6000/scripts/primus/        
        
</VirtualHost>

